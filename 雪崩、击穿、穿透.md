# 雪崩、击穿、穿透

## 缓存雪崩

缓存雪崩是指大量的应用请求无法在 Redis 缓存中进行处理，紧接着，应用将大量请求发送到数据库层，导致数据库层的压力激增，甚至导致数据库雪崩、导致整个系统崩溃。

### 缓存中有大量数据同时过期，导致大量请求无法得到处理

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101133230724-1274236351.png)

解决方案一：避免大量数据设置相同的过期时间，过期时间加上短暂的随机数(假设1-3分钟)。

解决方案二：
服务降级，在发生缓存雪崩的时候，针对不同的数据采用不同的处理方式。
对于非核心业务，可以在无法获取缓存数据时，提供预定义信息、空值或者错误信息。
对于核心业务，可以继续允许查询缓存继续读取数据库信息。

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101133816575-894308992.png)

### redis实例宕机，无法处理请求，请求直达数据库层

解决方案一：在业务系统中实现服务熔断或者请求限流机制。

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101135708915-1548466185.png)

一段时间内如果redis多次获取失败，就可以进入熔断状态，之后一段时间允许少量请求通过，如果请求都执行成功，则退出熔断状态，如果请求依然失败，那么继续试探。

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101135617019-1510973950.png)

## 缓存击穿

### 访问热点数据非常频繁，无法在缓存中处理

缓存击穿经常发生在热点数据失效时，为了避免缓存击穿，其实可以给特别频繁的热点数据不设置过期时间，这样数据都可以在缓存中处理。

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101141042426-1512138522.png)

## 缓存穿透

### 访问的数据机不在redis中，也不再数据库中

如果数据又不在redis中，又不在数据库中，那么缓存就成了摆设，请求都会直接到数据库。

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101141534120-1696023396.png)

原因1：业务层误操作，redis中和数据库中的数据被误删除了
原因2：恶意攻击，专门访问数据库中没有的数据

解决方案1：设置缓存空值或者缺省值，直接返回到业务，避免大量请求到数据库中。

解决方案2：使用[布隆过滤器](https://redis.io/docs/data-types/probabilistic/bloom-filter/)快速判断数据是否存在，避免查询数据库中数据是否存在。

解决方案3：请求入口检测数据是否合法，非法的直接过滤

## 总结

![img](https://img2023.cnblogs.com/blog/1218485/202311/1218485-20231101142814618-1158111575.png)

服务熔断、服务降级、请求限流这些方法都是属于“有损”方案，在保证数据库和整体系统稳定的同时，会对业务应用带来负面影响。所以最好是提前预防。

- 针对缓存雪崩，合理地设置数据过期时间，以及搭建高可靠缓存集群；
- 针对缓存击穿，在缓存访问非常频繁的热点数据时，不要设置过期时间；
- 针对缓存穿透，提前在入口前端实现恶意请求检测，或者规范数据库的数据删除操作，避免误删除

> 布隆过滤器使用redis即可实现，可以参考这个链接 https://oss.redislabs.com/redisbloom/